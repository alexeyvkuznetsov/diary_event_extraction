# **Цифровая герменевтика эго-документа: инструментарий для извлечения событий с помощью LLM**

## Описание проекта

Данный репозиторий содержит код и данные, использованные в исследовании восприятия европейских революций 1848-1849 гг. в Российской империи на материале дневника К.А. Березкина. Проект представляет собой Python-инструментарий для автоматического анализа текстов исторических эго-документов с целью выявления, извлечения и структурирования тематически релевантной информации.

Основная цель — предоставить исследователям-историкам инструмент для первичной обработки больших объемов текстовых данных, который позволяет трансформировать нарративный источник в структурированный набор данных (`capta`), пригодный для количественного и качественного анализа.

## Научный контекст

Этот инструментарий был разработан в рамках подготовки научной статьи. **Репозиторий обеспечивает полную прозрачность и воспроизводимость результатов, представленных в публикации.**

> Кузнецов А.В. Цифровая герменевтика эго-документа: Сравнительный анализ больших языковых моделей на материале дневника К.А. Березкина (1849 г.) 

## Как цитировать

Если вы используете этот код или данные в своем исследовании, пожалуйста, цитируйте **и статью, и этот репозиторий**.

1.  **Статья:** [Полная библиографическая ссылка на вашу статью]
2.  **Код и данные:** Alexey Kuznetsov. (2025). *Digital Hermeneutics of an Ego-Document: A Toolkit for Event Extraction using LLMs (Version 1.0.0)*. Zenodo. [DOI будет присвоен после архивации репозитория на Zenodo].

## Обзор содержимого репозитория

*   `src/info_extraction.py`: Основной Python-скрипт для запуска процесса извлечения информации.
*   `data/`: Директория с исходными данными для исследования.
    *   `diary_with_id.csv`: **Источник.** Полный текст дневника К.А. Березкина в формате CSV.
    *   `gold.csv`: **Эталонный набор данных («золотой стандарт»).** 34 записи из дневника, размеченные экспертом как релевантные. Использовался для оценки производительности моделей.
*   `knowledge_map.json`: **Онтология исследования.** Иерархическая Карта Знаний, которая использовалась для классификации извлекаемых событий.
*   `results/`: Директория с результатами работы скрипта.
    *   `model_outputs/`: **"Сырые" результаты.** JSON-файлы с полными ответами каждой из четырех протестированных моделей.
*   `docs/`: Дополнительная документация и материалы из статьи.
    *   `Supplement_1.pdf`: **Приложение 1 из статьи.** Подробное описание структуры выходных данных (JSON-объектов).
    *   `Supplement_2.pdf`: **Приложение 2 из статьи.** Таблица сравнения и кросс-верификации ответов моделей.
    *   `DATA_STRUCTURE.md`: Машиночитаемая и веб-версия Приложения 1 для удобства разработчиков.

## Файловая структура проекта

```
.
├── .env                         # Переменные окружения (API-ключ)
├── .gitignore                   # Файлы, игнорируемые Git
├── README.md                    # Этот файл
├── requirements.txt             # Зависимости Python
├── src/
│   └── info_extraction.py       # Основной скрипт Python
├── knowledge_map.json           # Онтология (Карта Знаний)
├── data/                        # Входные данные
│   ├── diary_with_id.csv
│   └── gold.csv
├── results/                     # Результаты работы
│   └── model_outputs/           # Выходные данные моделей
│       ├── gemini-2.5-pro.json
│       ├── o3.json
│       ├── grok3.json
│       └── deepseek-v3.json
├── docs/                        # Документация и приложения
│   ├── Supplement_1.pdf         # Приложение 1 (Структура данных)
│   ├── Supplement_2.pdf         # Приложение 2 (Таблица верификации)
│   └── DATA_STRUCTURE.md        # Веб-версия Приложения 1
...
```

## Ключевые возможности

*   **Извлечение данных с помощью большой языковой модели:** Скрипт использует языковую модель для одновременного извлечения, анализа и классификации фрагментов.
*   **Использование доменно-ориентированной онтологии:** Предопределенная, иерархическая онтология (`knowledge_map.json`) позволяет стандартизировать классификацию извлеченных событий.
*   **Структурированный и валидированный вывод данных:** Использование библиотеки Pydantic гарантирует чистоту и предсказуемость итогового набора данных.
*   **Надежная отказоустойчивость и возобновляемость:** Многоуровневая система кэширования и сохранения промежуточных результатов позволяет возобновить работу скрипта с точного места остановки в случае сбоя.
*   **Управление API-запросами:** Встроен механизм для контроля частоты обращений к API и автоматические повторные попытки в случае ошибок.
*   **Продвинутый промпт-инжиниринг:** Системный промпт содержит детальные инструкции и примеры, что повышает качество и стабильность ответов модели.

## Технологический стек

*   **Python 3.8+**
*   **Библиотеки:** `pandas`, `openai`, `pydantic`, `python-dotenv`, `logging`.

## Установка и запуск

### Предварительные требования

*   Установленный Python 3.8 или выше.
*   API-ключ для доступа к модели LLM (например, из Google AI Studio).

### Шаги по установке

1.  **Клонируйте репозиторий:**
    ```bash
    git clone [URL_вашего_репозитория]
    cd [название_папки_репозитория]
    ```

2.  **Создайте и активируйте виртуальное окружение (рекомендуется):**
    ```bash
    python -m venv venv
    # Для Windows: venv\Scripts\activate
    # Для macOS/Linux: source venv/bin/activate
    ```

3.  **Установите зависимости:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройте переменные окружения:**
    *   Создайте файл `.env` в корневой директории проекта.
    *   Добавьте в него ваш API-ключ: `GEMINI_API_KEY="ВАШ_API_КЛЮЧ"`

### Запуск скрипта

Выполните скрипт из корневой директории проекта:
```bash
python src/info_extraction.py
```
Скрипт начнет обработку записей из `data/diary_with_id.csv` и будет сохранять результаты в директории `results/`.

## Структура выходных данных

Каждое извлеченное событие представлено JSON-объектом, структура которого подробно описана в файле `docs/Supplement_1.pdf` (и `docs/DATA_STRUCTURE.md`). Пример объекта:

```json
{
    "entry_id": 97,
    "event_id": "AUTHOR_PERCEPTION_OPINION_AUTH",
    "event_name": "Выражение поддержки/осуждения действий властей/конкретных государств",
    "event_subtype_custom": "Уверенность в стабильности режима Николая I",
    "description": "Автор выражает личное убеждение и поддержку действующей власти, заявляя, что пока правит «мудрый венценосец» Николай I, революционный переворот в России невозможен.",
    "source_date": "1849-04-08",
    "location_normalized": "Россия",
    "brief_context": "Правление Николая I характеризовалось жестким подавлением любого инакомыслия...",
    "information_source_type": "Личные наблюдения и опыт автора",
    "confidence": "High",
    "text_fragment": "...но пока царствует такой мудрый венценосец, как Николай Первый, этого никогда не может случиться..."
}
```

## Лицензия

[MIT License](LICENSE)

Copyright (c) 2025 Кузнецов Алексей
